apiVersion: front.in-cloud.io/v1alpha1
kind: Factory
metadata:
  name: statefulset-details
spec:
  key: statefulset-details
  sidebarTags:
    - statefulset-sidebar
  withScrollableMainContentCard: true
  urlsToFetch:
    - "/api/clusters/{2}/k8s/apis/apps/v1/namespaces/{3}/statefulsets/{6}"

  data:
    # Header section
    - type: antdFlex
      data:
        id: header-row
        gap: 6
        align: center
        style:
          marginBottom: 24px
      children:
        # Resource type badge
        - type: antdText
          data:
            id: header-badge
            text: SS
            title: StatefulSet
            style:
              fontSize: 20px
              lineHeight: 24px
              padding: "0 9px"
              borderRadius: "20px"
              minWidth: 24
              display: inline-block
              textAlign: center
              whiteSpace: nowrap
              color: "#fff"
              backgroundColor: "#2b9af3"
              fontFamily: RedHatDisplay, Overpass, overpass, helvetica, arial, sans-serif
              fontWeight: 400
        # StatefulSet name
        - type: parsedText
          data:
            id: header-name
            text: "{reqsJsonPath[0]['.metadata.name']['-']}"
            style:
              fontSize: 20px
              lineHeight: 24px
              fontFamily: RedHatDisplay, Overpass, overpass, helvetica, arial, sans-serif

    # Tabs section
    - type: antdTabs
      data:
        id: main-tabs
        defaultActiveKey: details
        items:
          # Details tab
          - key: details
            label: Details
            children:
              # Main info card
              - type: ContentCard
                data:
                  id: details-card
                  style:
                    marginBottom: 24px
                children:
                  # Card title
                  - type: antdText
                    data:
                      id: details-title
                      text: StatefulSet details
                      strong: true
                      style:
                        fontSize: 20px
                        marginBottom: 12px

                  # Space under title
                  - type: Spacer
                    data:
                      id: details-spacer
                      $space: 16

                  # Two-column grid
                  - type: antdRow
                    data:
                      id: details-grid
                      gutter: [48, 12]
                    children:
                      # Left column
                      - type: antdCol
                        data:
                          id: left-col
                          span: 12
                        children:
                          - type: antdFlex
                            data:
                              id: left-col-stack
                              vertical: true
                              gap: 24
                            children:
                              # Name
                              - type: antdFlex
                                data:
                                  id: name-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: name-label
                                      text: Name
                                      strong: true
                                  - type: parsedText
                                    data:
                                      id: name-value
                                      text: "{reqsJsonPath[0]['.metadata.name']['-']}"

                              # Namespace link block (include)
                              - type: antdFlex
                                data:
                                  id: namespace-block
                                  vertical: true
                                  gap: 8
                                children:
                                  {{ include "incloud-web-resources.factory.links.namespace-details" . | nindent 34}}

                              # Labels block (include)
                              - type: antdFlex
                                data:
                                  id: labels-block
                                  vertical: true
                                  gap: 8
                                children:
                                  {{ include "incloud-web-resources.factory.labels" . | nindent 34}}

                              # Node selector block (include)
                              - type: antdFlex
                                data:
                                  id: node-selector-block
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.labels.base.selector" (dict
                                      "type" "node"
                                      "title" "Node selector"
                                      "jsonPath" ".spec.template.spec.nodeSelector"
                                    ) | nindent 34
                                  }}


                              # Pod selector block (include)
                              - type: antdFlex
                                data:
                                  id: pod-selector-block
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.labels.base.selector" (dict
                                      "type" "pod"
                                      "title" "Pod selector"
                                      "jsonPath" ".spec.template.metadata.labels"
                                    ) | nindent 34
                                  }}

                              # Tolerations counter (include)
                              - type: antdFlex
                                data:
                                  id: tolerations-counter-block
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.counters.fields" (dict
                                      "jsonPath" ".spec.template.spec.tolerations"
                                      "type" "tolerations"
                                      "title" "Tolerations"
                                    ) | nindent 34
                                  }}

                              # Annotations counter (include)
                              - type: antdFlex
                                data:
                                  id: annotations-counter-block
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.counters.annotations" . | nindent 34}}

                              # Created time (include)
                              - type: antdFlex
                                data:
                                  id: created-time-block
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.time.create" (dict
                                    "req" ".metadata.creationTimestamp"
                                    "text" "Created"
                                    ) | nindent 34
                                  }}

                              # Owner (fallback when missing)
                              - type: antdFlex
                                data:
                                  id: owner-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: owner-label
                                      text: Owner
                                      strong: true
                                  - type: parsedText
                                    data:
                                      id: owner-value
                                      text: "No owner"
                                      style:
                                        color: red

                      # Right column
                      - type: antdCol
                        data:
                          id: right-col
                          span: 12
                        children:
                          - type: antdFlex
                            data:
                              id: right-col-stack
                              vertical: true
                              gap: 24
                            children:
                              # Current replicas
                              - type: antdFlex
                                data:
                                  id: current-count-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: current-count-label
                                      text: Current count
                                      strong: true
                                  - type: parsedText
                                    data:
                                      id: current-count-value
                                      text: "{reqsJsonPath[0]['.status.replicas']['-']}"
                              # Desired replicas
                              - type: antdFlex
                                data:
                                  id: desired-count-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: desired-count-label
                                      text: Desired count
                                      strong: true
                                  - type: parsedText
                                    data:
                                      id: desired-count-value
                                      text: "{reqsJsonPath[0]['.spec.replicas']['-']}"

                  # Volumes section
                  - type: antdCol
                    data:
                      id: volumes-section-col
                      style:
                        marginTop: 10
                        padding: 10
                    children:
                      - type: VisibilityContainer
                        data:
                          id: volumes-visibility
                          value: "{reqsJsonPath[0]['.spec.template.spec.volumes']['-']}"
                          style:
                            margin: 0
                            padding: 0
                        children:
                          - type: antdText
                            data:
                              id: volumes-title
                              text: Volumes
                              strong: true
                              style:
                                fontSize: 22px
                                marginBottom: 32px
                          - type: EnrichedTable
                            data:
                              id: volumes-table
                              fetchUrl: "/api/clusters/{2}/k8s/apis/apps/v1/namespaces/{3}/statefulsets/{6}"
                              clusterNamePartOfUrl: "{2}"
                              customizationId: factory-statefulset-details-volume-list
                              baseprefix: "/openapi-ui"
                              withoutControls: true
                              pathToItems:
                                - spec
                                - template
                                - spec
                                - volumes

                  # Init containers section
                  - type: antdCol
                    data:
                      id: init-containers-section-col
                      style:
                        marginTop: 10
                        padding: 10
                    children:
                      - type: VisibilityContainer
                        data:
                          id: init-containers-visibility
                          value: "{reqsJsonPath[0]['.spec.template.spec.initContainers']['-']}"
                          style:
                            margin: 0
                            padding: 0
                        children:
                          - type: antdText
                            data:
                              id: init-containers-title
                              text: Init containers
                              strong: true
                              style:
                                fontSize: 22px
                                marginBottom: 32px
                          - type: EnrichedTable
                            data:
                              id: init-containers-table
                              fetchUrl: "/api/clusters/{2}/k8s/apis/apps/v1/namespaces/{3}/statefulsets/{6}"
                              clusterNamePartOfUrl: "{2}"
                              customizationId: factory-statefulset-details-init-containers-list
                              baseprefix: "/openapi-ui"
                              withoutControls: true
                              pathToItems:
                                - spec
                                - template
                                - spec
                                - initContainers

                  # Containers section
                  - type: antdCol
                    data:
                      id: containers-section-col
                      style:
                        marginTop: 10
                        padding: 10
                    children:
                      - type: VisibilityContainer
                        data:
                          id: containers-visibility
                          value: "{reqsJsonPath[0]['.spec.template.spec.containers']['-']}"
                          style:
                            margin: 0
                            padding: 0
                        children:
                          - type: antdText
                            data:
                              id: containers-title
                              text: Containers
                              strong: true
                              style:
                                fontSize: 22px
                                marginBottom: 32px
                          - type: EnrichedTable
                            data:
                              id: containers-table
                              fetchUrl: "/api/clusters/{2}/k8s/apis/apps/v1/namespaces/{3}/statefulsets/{6}"
                              clusterNamePartOfUrl: "{2}"
                              customizationId: factory-statefulset-details-containers-list
                              baseprefix: "/openapi-ui"
                              withoutControls: true
                              pathToItems:
                                - spec
                                - template
                                - spec
                                - containers

          # YAML tab
          - key: yaml
            label: YAML
            children:
              - type: YamlEditorSingleton
                data:
                  id: yaml-editor
                  cluster: "{2}"
                  isNameSpaced: true
                  type: apis
                  apiGroup: apps
                  apiVersion: v1
                  typeName: statefulsets
                  prefillValuesRequestIndex: 0
                  substractHeight: 400

          # Pods tab
          - key: pods
            label: Pods
            children:
              - type: EnrichedTable
                data:
                  id: pods-table
                  fetchUrl: "/api/clusters/{2}/k8s/api/v1/namespaces/{3}/pods"
                  clusterNamePartOfUrl: "{2}"
                  customizationId: factory-/v1/pods
                  baseprefix: "/openapi-ui"
                  withoutControls: true
                  labelsSelectorFull:
                    reqIndex: 0
                    pathToLabels:
                      - spec
                      - template
                      - metadata
                      - labels
                  pathToItems:
                    - items
