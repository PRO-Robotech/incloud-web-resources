apiVersion: front.in-cloud.io/v1alpha1
kind: Factory
metadata:
  name: crd-details
spec:
  # Unique key for this factory
  key: crd-details

  # Sidebar tag for grouping in UI
  sidebarTags:
    - customresourcedefinitions-sidebar

  # URL for fetching CRD details
  urlsToFetch:
    - /api/clusters/{2}/k8s/apis/apiextensions.k8s.io/v1/customresourcedefinitions/{5}

  # Enable scrollable main content
  withScrollableMainContentCard: true

  data:
    # === HEADER SECTION ===
    - type: antdFlex
      data:
        id: header-row
        align: center
        gap: 6
        style:
          marginBottom: 24px
      children:
        # CRD badge
        - type: antdText
          data:
            id: header-badge
            text: CRD
            title: CRD
            style:
              backgroundColor: "#2b9af3"
              borderRadius: 20px
              color: "#fff"
              display: inline-block
              fontFamily: RedHatDisplay, Overpass, overpass, helvetica, arial, sans-serif
              fontSize: 20px
              fontWeight: 400
              lineHeight: 24px
              minWidth: 24
              padding: 0 9px
              textAlign: center
              whiteSpace: nowrap
        # CRD name
        - type: parsedText
          data:
            id: header-name
            text: "{reqsJsonPath[0]['.metadata.name']['-']}"
            style:
              fontFamily: RedHatDisplay, Overpass, overpass, helvetica, arial, sans-serif
              fontSize: 20px
              lineHeight: 24px

    # === TABS SECTION ===
    - type: antdTabs
      data:
        id: tabs-root
        defaultActiveKey: details
        items:

          # --- DETAILS TAB ---
          - key: details
            label: Details
            children:
              # Main details card
              - type: ContentCard
                data:
                  id: details-card
                  style:
                    marginBottom: 24px
                children:
                  # Title
                  - type: antdText
                    data:
                      id: details-title
                      text: CustomResourceDefinition details
                      strong: true
                      style:
                        fontSize: 20px
                        marginBottom: 12px

                  # Spacer for separation
                  - type: Spacer
                    data:
                      id: details-spacer
                      $space: 16

                  # Grid layout (left & right columns)
                  - type: antdRow
                    data:
                      id: details-grid
                      gutter: [48, 12]
                    children:

                      # LEFT COLUMN — metadata and creation info
                      - type: antdCol
                        data:
                          id: details-col-left
                          span: 12
                        children:
                          - type: antdFlex
                            data:
                              id: left-stack
                              vertical: true
                              gap: 24
                            children:
                              # Name field
                              - type: antdFlex
                                data:
                                  id: field-name-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: field-name-label
                                      text: Name
                                      strong: true
                                  - type: parsedText
                                    data:
                                      id: field-name-value
                                      text: "{reqsJsonPath[0]['.metadata.name']['-']}"
                              # Labels block
                              - type: antdFlex
                                data:
                                  id: labels-block
                                  vertical: true
                                  gap: 8
                                children:
                                  {{ include "incloud-web-resources.factory.labels" . | nindent 34 }}

                              # Annotations counter block
                              - type: antdFlex
                                data:
                                  id: ds-annotations
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.counters.object.fields" (dict
                                      "jsonPath" ".metadata.annotations"
                                      "type" "annotations"
                                      "title" "Annotations"
                                    ) | nindent 34
                                  }}

                              # Creation time
                              - type: antdFlex
                                data:
                                  id: created-time-block
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.time.create" (dict
                                    "req" ".metadata.creationTimestamp"
                                    "text" "Created"
                                    ) | nindent 30
                                  }}
                              # Owner info
                              - type: antdFlex
                                data:
                                  id: owner-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: owner-label
                                      text: Owner
                                      strong: true
                                  - type: parsedText
                                    data:
                                      id: owner-value
                                      text: "No owner"
                                      style:
                                        color: red

                      # RIGHT COLUMN — CRD spec info
                      - type: antdCol
                        data:
                          id: details-col-right
                          span: 12
                        children:
                          - type: antdFlex
                            data:
                              id: right-stack
                              vertical: true
                              gap: 24
                            children:
                              # Group field
                              - type: antdFlex
                                data:
                                  id: group-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: group-label
                                      text: Group
                                      strong: true
                                  - type: parsedText
                                    data:
                                      id: group-value
                                      text: "{reqsJsonPath[0]['.spec.group']['-']}"
                              # Scope field
                              - type: antdFlex
                                data:
                                  id: scope-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: scope-label
                                      text: Scope
                                      strong: true
                                  - type: parsedText
                                    data:
                                      id: scope-value
                                      text: "{reqsJsonPath[0]['.spec.scope']['-']}"
                              # Latest stored version
                              - type: antdFlex
                                data:
                                  id: latest-version-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: latest-version-label
                                      text: Latest version
                                      strong: true
                                  - type: parsedText
                                    data:
                                      id: latest-version-value
                                      text: "{reqsJsonPath[0]['.status.storedVersions[0]']['-']}"

                  # Conditions section
                  - type: antdCol
                    data:
                      id: conditions-section
                      style:
                        marginTop: 32px
                        padding: 16px
                    children:
                      - type: VisibilityContainer
                        data:
                          id: conditions-container
                          value: "{reqsJsonPath[0]['.status.conditions']['-']}"
                          style:
                            margin: 0
                            padding: 0
                        children:
                          - type: antdText
                            data:
                              id: conditions-title
                              text: Conditions
                              strong: true
                              style:
                                fontSize: 22px
                                marginBottom: 16px
                          - type: EnrichedTable
                            data:
                              id: conditions-table
                              fetchUrl: "/api/clusters/{2}/k8s/apis/apiextensions.k8s.io/v1/customresourcedefinitions/{5}"
                              clusterNamePartOfUrl: "{2}"
                              customizationId: factory-status-conditions
                              baseprefix: "/openapi-ui"
                              withoutControls: true
                              pathToItems:
                                - status
                                - conditions

                  # Versions section
                  - type: antdCol
                    data:
                      id: versions-section
                      style:
                        marginTop: 32px
                        padding: 16px
                    children:
                      - type: VisibilityContainer
                        data:
                          id: versions-container
                          value: "{reqsJsonPath[0]['.spec.versions']['-']}"
                          style:
                            margin: 0
                            padding: 0
                        children:
                          - type: antdText
                            data:
                              id: versions-title
                              text: Versions
                              strong: true
                              style:
                                fontSize: 22px
                                marginBottom: 16px
                          - type: EnrichedTable
                            data:
                              id: versions-table
                              fetchUrl: "/api/clusters/{2}/k8s/apis/apiextensions.k8s.io/v1/customresourcedefinitions/{5}"
                              clusterNamePartOfUrl: "{2}"
                              customizationId: versions-apiextensions.k8s.io.v1.customresourcedefinitions
                              baseprefix: "/openapi-ui"
                              withoutControls: true
                              pathToItems:
                                - spec
                                - versions

          # --- YAML TAB ---
          - key: yaml
            label: YAML
            children:
              - type: YamlEditorSingleton
                data:
                  id: yaml-editor
                  apiGroup: apiextensions.k8s.io
                  apiVersion: v1
                  cluster: "{2}"
                  isNameSpaced: false
                  prefillValuesRequestIndex: 0
                  substractHeight: 400
                  type: apis
                  typeName: customresourcedefinitions

          # --- INSTANCES TAB ---
          - key: instance
            label: Instances
            children:
              - type: EnrichedTable
                data:
                  id: instances-table
                  fetchUrl: "/api/clusters/{2}/k8s/apis/{reqsJsonPath[0]['.spec.group']['-']}/{reqsJsonPath[0]['.status.storedVersions[0]']['-']}/{reqsJsonPath[0]['.spec.names.plural']['-']}"
                  clusterNamePartOfUrl: "{2}"
                  customizationId: instances-crd
                  baseprefix: "/openapi-ui"
                  withoutControls: true
                  pathToItems:
                    - items
