apiVersion: front.in-cloud.io/v1alpha1
kind: Factory
metadata:
  name: pod-details
spec:
  key: pod-details
  sidebarTags:
    - pods-sidebar
  withScrollableMainContentCard: true
  urlsToFetch:
    - "/api/clusters/{2}/k8s/api/v1/namespaces/{3}/pods/{6}"

  # Header row with badge, pod name, and status
  data:
    - type: antdFlex
      data:
        id: header-row
        gap: 6
        align: center
        style:
          marginBottom: 24px
      children:
        # Pod badge
        - type: antdText
          data:
            id: header-badge
            text: P
            title: Pods
            style:
              fontSize: 20px
              lineHeight: 24px
              padding: "0 9px"
              borderRadius: "20px"
              minWidth: 24
              display: inline-block
              textAlign: center
              whiteSpace: nowrap
              color: "#fff"
              backgroundColor: "#009596"
              fontFamily: RedHatDisplay, Overpass, overpass, helvetica, arial, sans-serif
              fontWeight: 400
        # Pod name next to badge
        - type: parsedText
          data:
            id: header-pod-name
            text: "{reqsJsonPath[0]['.metadata.name']['-']}"
            style:
              fontSize: 20px
              lineHeight: 24px
              fontFamily: RedHatDisplay, Overpass, overpass, helvetica, arial, sans-serif

        # Pod readiness/status indicator
        - type: StatusText
          data:
            id: header-pod-status
            value: "{reqsJsonPath[0]['.status.conditions[?(@.type=='Ready')].reason']['fallback']}"
            criteriaSuccess: equals
            valueToCompareSuccess:
              - "PodReady"
              - "ContainersReady"
              - "Initialized"
              - "PodCompleted"
              - "fallback"
            criteriaError: equals
            valueToCompareError:
              - "ContainersNotReady"
              - "CrashLoopBackOff"
              - "ImagePullBackOff"
              - "ErrImagePull"
              - "CreateContainerConfigError"
            successText: "{reqsJsonPath[0]['.status.conditions[?(@.type=='Ready')].reason']['Available']}"
            errorText: "{reqsJsonPath[0]['.status.conditions[?(@.type=='Ready')].reason']['Unavailable']}"
            fallbackText: "{reqsJsonPath[0]['.status.conditions[?(@.type=='Ready')].reason']['-']}"

    # Tabs with Details, YAML, Logs, and Terminal views
    - type: antdTabs
      data:
        id: pod-tabs
        defaultActiveKey: "details"
        items:
          # Details tab with metadata and spec
          - key: "details"
            label: "Details"
            children:
              - type: ContentCard
                data:
                  id: details-card
                  style:
                    marginBottom: 24px
                children:
                  # Title of the details section
                  - type: antdText
                    data:
                      id: details-title
                      text: "Pod details"
                      strong: true
                      style:
                        fontSize: 20
                        marginBottom: 12px
                  # Spacer before grid
                  - type: Spacer
                    data:
                      id: details-spacer
                      "$space": 16
                  # Two-column layout for metadata (left) and status/spec (right)
                  - type: antdRow
                    data:
                      id: details-grid
                      gutter: [48, 12]
                    children:
                      # Left column: metadata, links, labels
                      - type: antdCol
                        data:
                          id: col-left
                          span: 12
                        children:
                          - type: antdFlex
                            data:
                              id: col-left-stack
                              vertical: true
                              gap: 24
                            children:
                              # Display name label/value
                              - type: antdFlex
                                data:
                                  id: meta-name-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: meta-name-label
                                      strong: true
                                      text: "Name"
                                  - type: parsedText
                                    data:
                                      id: meta-name-value
                                      text: "{reqsJsonPath[0]['.metadata.name']['-']}"

                              # Namespace link (kept as include)
                              - type: antdFlex
                                data:
                                  id: meta-namespace-block
                                  vertical: true
                                  gap: 8
                                children:
                                  {{ include "incloud-web-resources.factory.links.details" (dict
                                      "reqIndex" 0
                                      "type" "namespace"
                                      "title" "Namespace"
                                      "jsonPath" ".metadata.namespace"
                                      "factory" "namespace-details"
                                    ) | nindent 34 
                                  }}

                              # Labels list (kept as include)
                              - type: antdFlex
                                data:
                                  id: meta-labels-block
                                  vertical: true
                                  gap: 8
                                children:
                                  {{ include "incloud-web-resources.factory.labels" . | nindent 38}}

                              # Node selector chips (kept as include)
                              - type: antdFlex
                                data:
                                  id: meta-node-selector-block
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.labels.base.selector" (dict
                                      "type" "node"
                                      "title" "Node selector"
                                      "jsonPath" ".spec.nodeSelector"
                                    ) | nindent 34
                                  }}

                              # Tolerations counter (kept as include)
                              - type: antdFlex
                                data:
                                  id: meta-tolerations-block
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.counters.fields" (dict
                                      "jsonPath" ".spec.tolerations"
                                      "type" "tolerations"
                                      "title" "Tolerations"
                                    ) | nindent 34
                                  }}

                              # Annotations counter block
                              - type: antdFlex
                                data:
                                  id: ds-annotations
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.counters.object.fields" (dict
                                      "jsonPath" ".metadata.annotations"
                                      "type" "annotations"
                                      "title" "Annotations"
                                    ) | nindent 34
                                  }}

                              # Created timestamp (kept as include)
                              - type: antdFlex
                                data:
                                  id: meta-created-block
                                  vertical: true
                                  gap: 4
                                children:
                                  {{ include "incloud-web-resources.factory.time.create" (dict
                                    "req" ".metadata.creationTimestamp"
                                    "text" "Created"
                                  ) | nindent 38
                                  }}

                              # Owner information (fallback when absent)
                              - type: antdFlex
                                data:
                                  id: meta-owner-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: meta-owner-label
                                      strong: true
                                      text: "Owner"
                                  - type: parsedText
                                    data:
                                      id: meta-owner-fallback
                                      strong: true
                                      text: "No owner"
                                      style:
                                        color: red

                      # Right column: status and runtime info
                      - type: antdCol
                        data:
                          id: col-right
                          span: 12
                        children:
                          - type: antdFlex
                            data:
                              id: col-right-stack
                              vertical: true
                              gap: 24
                            children:
                              # Status block with readiness reason mapping
                              - type: antdFlex
                                data:
                                  id: status-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: status-label
                                      strong: true
                                      text: "Status"
                                  # Pod readiness/status indicator
                                  - type: StatusText
                                    data:
                                      id: header-pod-status
                                      value: "{reqsJsonPath[0]['.status.conditions[?(@.type=='Ready')].reason']['fallback']}"
                                      criteriaSuccess: equals
                                      valueToCompareSuccess:
                                        - "PodReady"
                                        - "ContainersReady"
                                        - "Initialized"
                                        - "PodCompleted"
                                        - "fallback"
                                      criteriaError: equals
                                      valueToCompareError:
                                        - "ContainersNotReady"
                                        - "CrashLoopBackOff"
                                        - "ImagePullBackOff"
                                        - "ErrImagePull"
                                        - "CreateContainerConfigError"
                                      successText: "{reqsJsonPath[0]['.status.conditions[?(@.type=='Ready')].reason']['Available']}"
                                      errorText: "{reqsJsonPath[0]['.status.conditions[?(@.type=='Ready')].reason']['Unavailable']}"
                                      fallbackText: "{reqsJsonPath[0]['.status.conditions[?(@.type=='Ready')].reason']['-']}"


                              # Restart policy
                              - type: antdFlex
                                data:
                                  id: restart-policy-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: restart-policy-label
                                      strong: true
                                      text: "Restart policy"
                                  - type: parsedText
                                    data:
                                      id: restart-policy-value
                                      text: "{reqsJsonPath[0]['.spec.restartPolicy']['-']} restart"

                              # Active deadline seconds
                              - type: antdFlex
                                data:
                                  id: active-deadline-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: active-deadline-label
                                      strong: true
                                      text: "Active deadline seconds"
                                  - type: parsedText
                                    data:
                                      id: active-deadline-value
                                      text: "{reqsJsonPath[0]['.spec.activeDeadlineSeconds']['-']}"

                              # Pod IP
                              - type: antdFlex
                                data:
                                  id: pod-ip-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: pod-ip-label
                                      strong: true
                                      text: "Pod IP"
                                  - type: parsedText
                                    data:
                                      id: pod-ip-value
                                      text: "{reqsJsonPath[0]['.status.podIP']['-']}"

                              # Host IP
                              - type: antdFlex
                                data:
                                  id: host-ip-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: host-ip-label
                                      strong: true
                                      text: "Host IP"
                                  - type: parsedText
                                    data:
                                      id: host-ip-value
                                      text: "{reqsJsonPath[0]['.status.hostIP']['-']}"

                              # Node details link (kept as include)
                              - type: antdFlex
                                data:
                                  id: node-link-block
                                  vertical: true
                                  gap: 8
                                children:
                                  {{ include "incloud-web-resources.factory.links.details" (dict
                                      "reqIndex" 0
                                      "type" "node"
                                      "title" "Node"
                                      "jsonPath" ".spec.nodeName"
                                      "factory" "node-details"
                                    ) | nindent 34 
                                  }}

                              # QoS class
                              - type: antdFlex
                                data:
                                  id: qos-class-block
                                  vertical: true
                                  gap: 4
                                children:
                                  - type: antdText
                                    data:
                                      id: qos-class-label
                                      strong: true
                                      text: "QOS class"
                                  - type: parsedText
                                    data:
                                      id: qos-class-value
                                      text: "{reqsJsonPath[0]['.status.qosClass']['-']}"

                  # Volumes section (table is hidden if no volumes)
                  - type: antdCol
                    data:
                      id: volumes-col
                      style:
                        marginTop: 10
                        padding: 10
                    children:
                      - type: VisibilityContainer
                        data:
                          id: volumes-visibility
                          value: "{reqsJsonPath[0]['.spec.volumes']['-']}"
                          style:
                            margin: 0
                            padding: 0
                        children:
                          # Volumes title
                          - type: antdText
                            data:
                              id: volumes-title
                              text: "Volumes"
                              strong: true
                              style:
                                fontSize: 22
                                marginBottom: 32px
                          # Volumes table
                          - type: EnrichedTable
                            data:
                              id: volumes-table
                              fetchUrl: "/api/clusters/{2}/k8s/api/v1/namespaces/{3}/pods/{6}"
                              clusterNamePartOfUrl: "{2}"
                              customizationId: factory-pod-details-volume-list
                              baseprefix: "/openapi-ui"
                              withoutControls: true
                              pathToItems:
                                - spec
                                - volumes

                  # Init containers section (hidden if none)
                  - type: antdCol
                    data:
                      id: init-containers-col
                      style:
                        marginTop: 10
                        padding: 10
                    children:
                      {{ include "incloud-web-resources.factory.containers.table" (dict
                          "title" "Init containers"
                          "customizationId" "container-status-init-containers-list"
                          "type" "init-containers"
                          "apiGroup" "api/v1"
                          "kind" "pods"
                          "resourceName" "{6}"
                          "namespace" "{3}"
                          "jsonPath" ".status.initContainerStatuses"
                          "pathToItems" "['status','initContainerStatuses']"
                        ) | nindent 22 
                      }}

                  # Containers section (hidden if none)
                  - type: antdCol
                    data:
                      id: containers-col
                      style:
                        marginTop: 10
                        padding: 10
                    children:
                      {{ include "incloud-web-resources.factory.containers.table" (dict
                          "title" "Containers"
                          "customizationId" "container-status-containers-list"
                          "type" "containers"
                          "apiGroup" "api/v1"
                          "kind" "pods"
                          "resourceName" "{6}"
                          "namespace" "{3}"
                          "jsonPath" ".status.containerStatuses"
                          "pathToItems" "['status','containerStatuses']"
                        ) | nindent 22 
                      }}

                  # Conditions section (hidden if none)
                  - type: antdCol
                    data:
                      id: conditions-col
                      style:
                        marginTop: 10
                        padding: 10
                    children:
                      - type: VisibilityContainer
                        data:
                          id: conditions-visibility
                          value: "{reqsJsonPath[0]['.status.conditions']['-']}"
                          style:
                            margin: 0
                            padding: 0
                        children:
                          # Conditions title
                          - type: antdText
                            data:
                              id: conditions-title
                              text: "Conditions"
                              strong: true
                              style:
                                fontSize: 22
                          # Conditions table
                          - type: EnrichedTable
                            data:
                              id: conditions-table
                              fetchUrl: "/api/clusters/{2}/k8s/api/v1/namespaces/{3}/pods/{6}"
                              clusterNamePartOfUrl: "{2}"
                              customizationId: factory-status-conditions
                              baseprefix: "/openapi-ui"
                              withoutControls: true
                              pathToItems:
                                - status
                                - conditions

          # YAML tab with inline editor
          - key: "yaml"
            label: "YAML"
            children:
              - type: YamlEditorSingleton
                data:
                  id: yaml-editor
                  cluster: "{2}"
                  isNameSpaced: true
                  type: "builtin"
                  typeName: pods
                  prefillValuesRequestIndex: 0
                  substractHeight: 400

          # Logs tab with live pod logs
          - key: "logs"
            label: "Logs"
            children:
              - type: PodLogs
                data:
                  id: pod-logs
                  cluster: "{2}"
                  namespace: "{reqsJsonPath[0]['.metadata.namespace']['-']}"
                  podName: "{reqsJsonPath[0]['.metadata.name']['-']}"

          # Terminal tab with exec into pod
          - key: "terminal"
            label: "Terminal"
            children:
              - type: PodTerminal
                data:
                  id: pod-terminal
                  cluster: "{2}"
                  namespace: "{reqsJsonPath[0]['.metadata.namespace']['-']}"
                  podName: "{reqsJsonPath[0]['.metadata.name']['-']}"
